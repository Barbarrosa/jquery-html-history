(function(a){a.fn.htmlhistory=function(c){return c?this.bind("htmlhistory",c):this.trigger("htmlhistory")};var b=a.htmlhistory={options:{useHistory:true,useHashchange:true,pollingInterval:250,interceptLinks:true,disableHashLinks:true},init:function(c){var d,e=a(window);a.extend(b.options,c);if(b.options.useHistory&&b.detectHistorySupport()){e.bind("popstate",function(f){e.trigger("htmlhistory")})}if(b.options.useHashchange){e.bind("hashchange",function(f){e.trigger("htmlhistory")});if(!b.detectHashchangeSupport()){d=window.location.hash;setInterval(function(){if(d!==window.location.hash){e.trigger("hashchange");d=window.location.hash}},b.options.pollingInterval)}}if(b.options.interceptLinks){a("body").delegate("a[href^=/]","click",function(f){b.changeTo(a(this).attr("href"));f.preventDefault()})}if(b.options.disableHashLinks){a("body").delegate("a[href=#]","click",function(f){f.preventDefault()})}},changeTo:function(c){if(b.options.useHistory&&b.detectHistorySupport()){window.history.pushState(null,null,c);$win.trigger("htmlhistory")}else{if(c.indexOf("#")<0){c="#"+c}window.location.href=c}},detectHistorySupport:function(){return !!(window.history&&history.pushState)},detectHashchangeSupport:function(){var c="onhashchange" in window;if(!c&&window.setAttribute){window.setAttribute("onhashchange","return;");c=typeof window.onhashchange==="function"}return c}}}(jQuery));